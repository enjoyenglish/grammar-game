<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å­¦è‹±èªãƒ»æ–‡æ³•ãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --bg-color: #f0f7f7;
            --accent-color: #ffe66d;
            --correct-color: #ff922b;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 8px 0 #cbdadb;
            width: 95%;
            max-width: 650px;
            text-align: center;
            margin-top: 10px;
        }

        h1 { color: var(--primary-color); font-size: 1.4rem; margin-bottom: 10px; }

        /* æ–‡æ³•é¸æŠ */
        .grammar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .grammar-grid label {
            display: block;
            padding: 10px;
            background: #eee;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: 0.2s;
        }

        .grammar-grid input { display: none; }
        .grammar-grid input:checked + span {
            color: white;
        }
        .grammar-grid label:has(input:checked) {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 0 #3baea5;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #game-screen { display: none; }
        .word-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            min-height: 80px;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border: 3px dashed var(--secondary-color);
            border-radius: 15px;
        }

        .word-card {
            background: var(--accent-color);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: grab;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 4px 0 #d4c05d;
            user-select: none;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: var(--primary-color);
            color: white;
            box-shadow: 0 5px 0 #c44;
            font-weight: bold;
        }

        .btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #c44; }

        #score-display { font-size: 1.2rem; font-weight: bold; color: #555; }
        #feedback { margin-top: 15px; font-size: 1.2rem; font-weight: bold; min-height: 1.5em; }
    </style>
</head>
<body>

    <div id="setup-screen" class="container">
        <h1>ğŸ‡¬ğŸ‡§ æ–‡æ³•ãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
        <p style="font-size: 0.9rem;">å¾©ç¿’ã™ã‚‹æ–‡æ³•ã‚’é¸ã‚“ã§ã­ï¼ˆè¤‡æ•°OKï¼ï¼‰</p>
        <div class="grammar-grid">
            <label><input type="checkbox" value="passive"><span>å—ã‘èº«</span></label>
            <label><input type="checkbox" value="perfect"><span>å®Œäº†å½¢</span></label>
            <label><input type="checkbox" value="post"><span>å¾Œç½®ä¿®é£¾</span></label>
            <label><input type="checkbox" value="relative"><span>é–¢ä¿‚ä»£åè©</span></label>
            <label><input type="checkbox" value="ing"><span>é€²è¡Œå½¢</span></label>
            <label><input type="checkbox" value="inf_ger"><span>ä¸å®šè©ãƒ»å‹•åè©</span></label>
            <label><input type="checkbox" value="indirect"><span>é–“æ¥ç–‘å•æ–‡</span></label>
            <label><input type="checkbox" value="comp"><span>æ¯”è¼ƒ</span></label>
            <label><input type="checkbox" value="aux"><span>åŠ©å‹•è©</span></label>
            <label><input type="checkbox" value="if"><span>ä»®å®šæ³•</span></label>
            <label><input type="checkbox" value="verb_pattern"><span>want äºº to / ä½¿å½¹</span></label>
        </div>
        <button class="btn" onclick="startGame()">å†’é™ºé–‹å§‹ï¼</button>
    </div>

    <div id="game-screen" class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div id="score-display">Score: 0</div>
            <div id="q-count" style="color: #888;"></div>
        </div>
        <hr>
        <p id="japanese-text" style="font-size: 1.2rem; font-weight: bold; color: #333; margin: 20px 0;"></p>
        <div id="sortable-list" class="word-list"></div>
        <button class="btn" onclick="checkAnswer()">ãƒã‚§ãƒƒã‚¯ï¼</button>
        <div id="feedback"></div>
    </div>

    <script>
        const questions = [
            { cat: 'passive', ja: 'ã“ã®æ‰‹ç´™ã¯è‹±èªã§æ›¸ã‹ã‚Œã¾ã—ãŸã€‚', en: ['This', 'letter', 'was', 'written', 'in', 'English.'] },
            { cat: 'perfect', ja: 'ç§ã¯ä¸€åº¦ã‚‚äº¬éƒ½ã‚’è¨ªã‚ŒãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚', en: ['I', 'have', 'never', 'visited', 'Kyoto.'] },
            { cat: 'post', ja: 'ã‚ãã“ã§èµ°ã£ã¦ã„ã‚‹å°‘å¹´ã¯å¥ã§ã™ã€‚', en: ['The', 'boy', 'running', 'over', 'there', 'is', 'Ken.'] },
            { cat: 'relative', ja: 'ã“ã‚Œã¯ç§ãŒä¸€ç•ªå¥½ããªæœ¬ã§ã™ã€‚', en: ['This', 'is', 'the', 'book', 'that', 'I', 'like', 'the', 'best.'] },
            { cat: 'ing', ja: 'å½¼ã¯ä»Šã€ãŠé¢¨å‘‚ã§æ­Œã‚’æ­Œã£ã¦ã„ã¾ã™ã€‚', en: ['He', 'is', 'singing', 'a', 'song', 'in', 'the', 'bath', 'now.'] },
            { cat: 'inf_ger', ja: 'ç§ã¯ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã‚‹ã®ã‚’ã‚„ã‚ã¾ã—ãŸã€‚', en: ['I', 'stopped', 'watching', 'TV.'] },
            { cat: 'inf_ger', ja: 'å½¼ã¯åŒ»è€…ã«ãªã‚‹ã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€‚', en: ['He', 'decided', 'to', 'be', 'a', 'doctor.'] },
            { cat: 'indirect', ja: 'å½¼ãŒã©ã“ã«ä½ã‚“ã§ã„ã‚‹ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', en: ['Do', 'you', 'know', 'where', 'he', 'lives?'] },
            { cat: 'comp', ja: 'ã“ã®æ•°å­¦ã®å•é¡Œã¯ã€ã‚ã®å•é¡Œã‚ˆã‚Šé›£ã—ã„ã€‚', en: ['This', 'math', 'problem', 'is', 'more', 'difficult', 'than', 'that', 'one.'] },
            { cat: 'aux', ja: 'ã‚ãªãŸã¯ã“ã“ã§é´ã‚’è„±ãŒãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚', en: ['You', 'must', 'take', 'off', 'your', 'shoes', 'here.'] },
            { cat: 'if', ja: 'ã‚‚ã—ç§ãŒé³¥ãªã‚‰ã€ã‚ãªãŸã®ã¨ã“ã‚ã¸é£›ã‚“ã§ã„ãã®ã«ã€‚', en: ['If', 'I', 'were', 'a', 'bird,', 'I', 'would', 'fly', 'to', 'you.'] },
            { cat: 'verb_pattern', ja: 'æ¯ã¯ç§ã«éƒ¨å±‹ã‚’æƒé™¤ã™ã‚‹ã‚ˆã†ã«è¨€ã„ã¾ã—ãŸã€‚', en: ['My', 'mother', 'told', 'me', 'to', 'clean', 'my', 'room.'] },
            { cat: 'verb_pattern', ja: 'å½¼ã¯ç§ã«å½¼ã®è»Šã‚’ä½¿ã‚ã›ã¦ãã‚Œã¾ã—ãŸã€‚', en: ['He', 'let', 'me', 'use', 'his', 'car.'] }
        ];

        let currentQuestions = [], currentIndex = 0, totalScore = 0, attemptCount = 0;

        function startGame() {
            const selected = Array.from(document.querySelectorAll('.grammar-grid input:checked')).map(el => el.value);
            if (selected.length === 0) return alert('æ–‡æ³•ã‚’ï¼‘ã¤ä»¥ä¸Šé¸ã‚“ã§ã­ï¼');

            currentQuestions = questions.filter(q => selected.includes(q.cat)).sort(() => Math.random() - 0.5);
            if (currentQuestions.length === 0) return alert('ã”ã‚ã‚“ã­ã€ãã®æ–‡æ³•ã®å•é¡Œã¯æº–å‚™ä¸­ã ã‚ˆï¼');

            currentIndex = 0; totalScore = 0;
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            attemptCount = 1;
            const q = currentQuestions[currentIndex];
            document.getElementById('japanese-text').innerText = q.ja;
            document.getElementById('feedback').innerText = "";
            document.getElementById('q-count').innerText = `${currentIndex + 1} / ${currentQuestions.length}`;
            
            const list = document.getElementById('sortable-list');
            list.innerHTML = "";
            const shuffled = [...q.en].sort(() => Math.random() - 0.5);
            shuffled.forEach(word => {
                const div = document.createElement('div');
                div.className = 'word-card';
                div.innerText = word;
                list.appendChild(div);
            });
            new Sortable(list, { animation: 150, ghostClass: 'blue-background-class' });
        }

        function checkAnswer() {
            const userOrder = Array.from(document.getElementById('sortable-list').children).map(el => el.innerText);
            const correctOrder = currentQuestions[currentIndex].en;

            if (userOrder.join(' ') === correctOrder.join(' ')) {
                let pts = attemptCount === 1 ? 100 : (attemptCount === 2 ? 50 : 10);
                totalScore += pts;
                document.getElementById('score-display').innerText = "Score: " + totalScore;
                document.getElementById('feedback').innerHTML = `<span style="color:var(--correct-color)">æ­£è§£ï¼ +${pts}ç‚¹</span>`;
                
                setTimeout(() => {
                    currentIndex++;
                    if (currentIndex < currentQuestions.length) {
                        showQuestion();
                    } else {
                        alert(`å†’é™ºã‚¯ãƒªã‚¢ï¼\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${totalScore}ç‚¹`);
                        location.reload();
                    }
                }, 1200);
            } else {
                attemptCount++;
                document.getElementById('feedback').innerHTML = `<span style="color:#888; font-size: 0.9rem;">ãŠã—ã„ï¼ä¸¦ã³æ›¿ãˆã¦ã¿ã¦ã­ï¼ˆ${attemptCount}å›ç›®ï¼‰</span>`;
            }
        }
    </script>
</body>
</html>
