<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å­¦è‹±èªãƒ»çœŸã®æ§‹ç¯‰ãƒã‚¹ã‚¿ãƒ¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #ff6b6b; --secondary: #4ecdc4; --bg: #f8f9fa; --accent: #ffe66d; --gold: #ffd700; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 95%; max-width: 750px; text-align: center; }
        
        /* ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ */
        #score-board { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-around; align-items: center; }
        .score-val { font-size: 2rem; font-weight: bold; }
        .rank-badge { background: var(--gold); color: #333; padding: 5px 15px; border-radius: 50px; font-weight: bold; border: 2px solid white; }

        /* æ–‡æ³•é¸æŠã‚¨ãƒªã‚¢ï¼ˆã“ã“ãŒç¢ºå®Ÿã«å‹•ãã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ãŸï¼‰ */
        .grammar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin: 20px 0; }
        .grammar-item { 
            display: flex; align-items: center; justify-content: center; padding: 15px; 
            background: #f1f3f5; border-radius: 15px; cursor: pointer; border: 3px solid #dee2e6;
            font-weight: bold; transition: 0.2s; user-select: none;
        }
        .grammar-item input { margin-right: 10px; transform: scale(1.3); pointer-events: none; } /* inputè‡ªä½“ã®ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡åŠ¹åŒ–ã—ã¦labelå…¨ä½“ã§åå¿œã•ã›ã‚‹ */
        .grammar-item.selected { background: var(--secondary); color: white; border-color: #3baea5; box-shadow: 0 4px 10px rgba(78,205,196,0.3); }

        /* æ§‹ç¯‰ã‚¨ãƒªã‚¢ */
        .drop-zone { min-height: 110px; margin: 15px 0; padding: 15px; background: #fff; border: 3px dashed var(--secondary); border-radius: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; position: relative; }
        .drop-zone:empty::before { content: "ã“ã“ã«ãƒ”ãƒªã‚ªãƒ‰ã‚‚å«ã‚ã¦ä¸¦ã¹ã¦ã­"; color: #bbb; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .hand-zone { min-height: 110px; margin: 10px 0; padding: 15px; background: #eaeff2; border-radius: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        
        .word-card { background: white; border: 2px solid #ddd; padding: 12px 20px; border-radius: 12px; cursor: grab; font-weight: bold; font-size: 1.2rem; box-shadow: 0 4px 0 #ddd; }
        .word-card.period { background: #eee; color: var(--primary); }

        .btn { padding: 16px 50px; font-size: 1.3rem; border: none; border-radius: 50px; cursor: pointer; background: var(--primary); color: white; box-shadow: 0 6px 0 #c44; font-weight: bold; margin-top: 10px; }
        
        #explanation-box { display: none; margin-top: 20px; padding: 20px; border-radius: 15px; background: #e7f5ff; border-left: 10px solid var(--secondary); text-align: left; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #game-screen { display: none; }
        .notice { font-size: 0.85rem; color: #e63946; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="setup-screen" class="container">
    <h1 style="color:var(--primary)">ğŸ‡¬ğŸ‡§ æ–‡æ³•æ§‹ç¯‰ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
    <p>æŒ‘æˆ¦ã™ã‚‹æ–‡æ³•ã‚’é¸ã¼ã†ï¼ï¼ˆè¤‡æ•°é¸æŠOKï¼‰</p>
    <div class="grammar-grid" id="grid"></div>
    <button class="btn" onclick="startGame()">å†’é™ºé–‹å§‹ï¼</button>
</div>

<div id="game-screen" class="container">
    <div id="score-board">
        <div>SCORE <div id="score" class="score-val">0</div></div>
        <div>RANK <div id="rank" class="rank-badge">BEGINNER</div></div>
    </div>
    <div class="notice">âš ï¸ æ–‡é ­ã‚‚å°æ–‡å­—ã§ã™ã€‚ãƒ”ãƒªã‚ªãƒ‰ã€Œ . ã€ã‚„ã€Œ ? ã€ã‚‚æœ€å¾Œã«ä¸¦ã¹ã¦ã­ï¼</div>
    <p id="q-count" style="color:#888; margin:0;"></p>
    <p id="ja-text" style="font-size: 1.4rem; font-weight: bold; margin: 15px 0; color: #2d3436;"></p>
    
    <div class="drop-zone" id="drop-zone"></div>
    <div class="hand-zone" id="hand-zone"></div>
    
    <button class="btn" id="action-btn" onclick="check()">åˆ¤å®šï¼</button>
    
    <div id="explanation-box">
        <h3 style="margin-top:0; color:#0b7285;">ğŸ’¡ è§£èª¬ã‚³ãƒ¼ãƒŠãƒ¼</h3>
        <p id="exp-grammar" style="font-weight:bold; margin-bottom:5px;"></p>
        <p id="exp-text" style="line-height:1.5;"></p>
        <button class="btn" style="padding:10px 30px; font-size:1rem;" onclick="next()">æ¬¡ã¸é€²ã‚€ â–¶</button>
    </div>
    <div id="feedback" style="margin-top:15px; font-size:1.5rem;"></div>
</div>

<script>
const data = {
    passive: { name: "å—ã‘èº«", q: [
        {ja:"ã“ã®æ‰‹ç´™ã¯å¥ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚", en:["this", "letter", "was", "written", "by", "ken", "."], exp:"ã€beå‹•è©ï¼‹éå»åˆ†è©ã€‘ã§ã€Œï½ã•ã‚Œã‚‹ã€ã¨ã„ã†æ„å‘³ã€‚éå»å½¢ãªã®ã§wasã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"è‹±èªã¯å¤šãã®å›½ã§è©±ã•ã‚Œã¦ã„ã¾ã™ã€‚", en:["english", "is", "spoken", "in", "many", "countries", "."], exp:"speakã®éå»åˆ†è©ã¯spokenã€‚ç¾åœ¨ã®ç¿’æ…£ãªã®ã§isã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ãã®å¯ºã¯ç´„100å¹´å‰ã«å»ºã¦ã‚‰ã‚Œã¾ã—ãŸã€‚", en:["the", "temple", "was", "built", "about", "100", "years", "ago", "."], exp:"buildï¼ˆå»ºã¦ã‚‹ï¼‰ã®éå»åˆ†è©ã¯builtã€‚"},
        {ja:"ã“ã®ã‚±ãƒ¼ã‚­ã¯æ¯ã«ã‚ˆã£ã¦ä½œã‚‰ã‚Œã¾ã—ãŸã€‚", en:["this", "cake", "was", "made", "by", "my", "mother", "."], exp:"by ã€‡ã€‡ã§ã€Œã€‡ã€‡ã«ã‚ˆã£ã¦ã€ã‚’è¡¨ã—ã¾ã™ã€‚"},
        {ja:"ãã®çŒ«ã¯ã¿ã‚“ãªã«æ„›ã•ã‚Œã¦ã„ã¾ã™ã€‚", en:["the", "cat", "is", "loved", "by", "everyone", "."], exp:"loveã¯è¦å‰‡å‹•è©ãªã®ã§éå»åˆ†è©ã‚‚-edã‚’ã¤ã‘ã‚‹ã ã‘ã§ã™ã€‚"}
    ]},
    perfect: { name: "å®Œäº†å½¢", q: [
        {ja:"ç§ã¯3å¹´é–“ãšã£ã¨ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¦ã„ã¾ã™ã€‚", en:["i", "have", "played", "tennis", "for", "three", "years", "."], exp:"ã€haveï¼‹éå»åˆ†è©ã€‘ã€‚æœŸé–“ã‚’è¡¨ã™forï¼ˆï½ã®é–“ï¼‰ã‚’ã‚»ãƒƒãƒˆã§ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ã‚ãªãŸã¯ã‚‚ã†å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã‹ï¼Ÿ", en:["have", "you", "finished", "your", "homework", "yet", "?"], exp:"ç–‘å•æ–‡ã§ã¯yetï¼ˆã‚‚ã†ï¼‰ã‚’æ–‡æœ«ã«ç½®ãã¾ã™ã€‚"},
        {ja:"ç§ã¯ä¸€åº¦ã‚‚åŒ—æµ·é“ã¸è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", en:["i", "have", "never", "been", "to", "hokkaido", "."], exp:"ã€Œè¡Œã£ãŸã“ã¨ãŒã‚ã‚‹ã€ã¯been toã€‚ä¸€åº¦ã‚‚ãªã„å ´åˆã¯neverã‚’ç½®ãã¾ã™ã€‚"},
        {ja:"å½¼ã¯ã¡ã‚‡ã†ã©é§…ã«ç€ã„ãŸã¨ã“ã‚ã§ã™ã€‚", en:["he", "has", "just", "arrived", "at", "the", "station", "."], exp:"ã€Œã¡ã‚‡ã†ã©ï½ã—ãŸã¨ã“ã‚ã€ã¯justã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ç§ãŸã¡ã¯å­ä¾›ã®é ƒã‹ã‚‰å‹é”ã§ã™ã€‚", en:["we", "have", "been", "friends", "since", "we", "were", "children", "."], exp:"ã€Œï½ä»¥æ¥ãšã£ã¨ã€ã¯sinceã‚’ä½¿ã„ã¾ã™ã€‚"}
    ]},
    post: { name: "å¾Œç½®ä¿®é£¾", q: [
        {ja:"å‘ã“ã†ã§æ­Œã£ã¦ã„ã‚‹å¥³ã®å­ã¯èŠ±å­ã§ã™ã€‚", en:["the", "girl", "singing", "over", "there", "is", "hanako", "."], exp:"singing over thereï¼ˆã‚ãã“ã§æ­Œã£ã¦ã„ã‚‹ï¼‰ã¨ã„ã†å¡ŠãŒgirlã‚’å¾Œã‚ã‹ã‚‰ä¿®é£¾ã—ã¾ã™ã€‚"},
        {ja:"ã“ã‚Œã¯æ—¥æœ¬ã§ä½œã‚‰ã‚ŒãŸè»Šã§ã™ã€‚", en:["this", "is", "a", "car", "made", "in", "japan", "."], exp:"éå»åˆ†è©madeãŒcarã‚’å¾Œã‚ã‹ã‚‰èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚"},
        {ja:"ç§ã¯å½¼ã«ã‚ˆã£ã¦æ›¸ã‹ã‚ŒãŸæœ¬ã‚’èª­ã¿ã¾ã—ãŸã€‚", en:["i", "read", "a", "book", "written", "by", "him", "."], exp:"written by himï¼ˆå½¼ã«æ›¸ã‹ã‚ŒãŸï¼‰ãŒbookã‚’ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚"},
        {ja:"ãƒ”ã‚¢ãƒã‚’å¼¾ã„ã¦ã„ã‚‹å°‘å¹´ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["do", "you", "know", "the", "boy", "playing", "the", "piano", "?"], exp:"ç¾åœ¨åˆ†è©playingãŒboyã‚’ä¿®é£¾ã—ã¾ã™ã€‚"},
        {ja:"ã‚ãã“ã§èµ°ã£ã¦ã„ã‚‹çŠ¬ã‚’è¦‹ã¦ã€‚", en:["look", "at", "the", "dog", "running", "there", "."], exp:"running thereï¼ˆã‚ãã“ã§èµ°ã£ã¦ã„ã‚‹ï¼‰ãŒdogã‚’ä¿®é£¾ã—ã¾ã™ã€‚"}
    ]},
    relative: { name: "é–¢ä¿‚ä»£åè©", q: [
        {ja:"ã“ã‚Œã¯ç§ãŒæ˜¨æ—¥è²·ã£ãŸã‚«ãƒ¡ãƒ©ã§ã™ã€‚", en:["this", "is", "the", "camera", "that", "i", "bought", "yesterday", "."], exp:"å…ˆè¡Œè©cameraã‚’thatä»¥ä¸‹ã®æ–‡ãŒèª¬æ˜ã—ã¦ã„ã¾ã™ã€‚"},
        {ja:"ç§ã¯è¦ªåˆ‡ãªå¿ƒã‚’æŒã¤å°‘å¹´ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚", en:["i", "know", "a", "boy", "who", "has", "a", "kind", "heart", "."], exp:"äººã‚’å…ˆè¡Œè©ã«ã™ã‚‹æ™‚ã¯whoã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ã‚ãªãŸãŒæ¢ã—ã¦ã„ã‚‹éµã¯ã“ã“ã«ã‚ã‚Šã¾ã™ã€‚", en:["the", "key", "which", "you", "are", "looking", "for", "is", "here", "."], exp:"ç‰©(key)ã‚’ä¿®é£¾ã™ã‚‹æ™‚ã¯whichã‚„thatã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ã‚ãã“ã«ç«‹ã£ã¦ã„ã‚‹ç”·æ€§ã¯ç§ã®çˆ¶ã§ã™ã€‚", en:["the", "man", "who", "is", "standing", "there", "is", "my", "father", "."], exp:"ä¸»èªã®å½¹å‰²ã‚’ã™ã‚‹whoï¼ˆä¸»æ ¼ï¼‰ã§ã™ã€‚"},
        {ja:"ã“ã‚Œã¯å¤šãã®å†™çœŸãŒã‚ã‚‹æœ¬ã§ã™ã€‚", en:["this", "is", "a", "book", "which", "has", "many", "pictures", "."], exp:"ã€Œå¤šãã®å†™çœŸã‚’æŒã£ã¦ã„ã‚‹æœ¬ã€ã¨ã„ã†æ§‹é€ ã§ã™ã€‚"}
    ]},
    indirect: { name: "é–“æ¥ç–‘å•æ–‡", q: [
        {ja:"å½¼ãŒã©ã“ã«ä½ã‚“ã§ã„ã‚‹ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["do", "you", "know", "where", "he", "lives", "?"], exp:"ç–‘å•è©(where)ã®å¾Œã¯ã€Œä¸»èªï¼‹å‹•è©ã€ã®èªé †ã«æˆ»ã‚Šã¾ã™ã€‚livesã®sã‚’å¿˜ã‚Œãšã«ï¼"},
        {ja:"å½¼å¥³ãŒä½•ã¨è¨€ã£ãŸã‹æ•™ãˆã¦ãã ã•ã„ã€‚", en:["please", "tell", "me", "what", "she", "said", "."], exp:"what she saidï¼ˆå½¼å¥³ãŒè¨€ã£ãŸã“ã¨ï¼‰ã®èªé †ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚"},
        {ja:"ç§ã¯ãã®æ™‚ã€ä½•æ™‚ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", en:["i", "did", "not", "know", "what", "time", "it", "was", "then", "."], exp:"what timeã®å¾Œã«it wasã¨ã„ã†è‚¯å®šæ–‡ã®èªé †ã‚’ç¶šã‘ã¾ã™ã€‚"},
        {ja:"å½¼ãŒèª°ãªã®ã‹ç§ã¯çŸ¥ã‚Šã¾ã›ã‚“ã€‚", en:["i", "don't", "know", "who", "he", "is", "."], exp:"who is he? ã§ã¯ãªã who he is ã«ãªã‚Šã¾ã™ã€‚"},
        {ja:"ã„ã¤ä¼šè­°ãŒå§‹ã¾ã‚‹ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["do", "you", "know", "when", "the", "meeting", "will", "start", "?"], exp:"whenã®å¾Œã¯ä¸»èª(the meeting)ï¼‹å‹•è©ã§ã™ã€‚"}
    ]},
    if: { name: "ä»®å®šæ³•", q: [
        {ja:"ã‚‚ã—ç§ãŒã‚ãªãŸãªã‚‰ã€ãã“ã¸è¡Œãã ã‚ã†ã«ã€‚", en:["if", "i", "were", "you", ",", "i", "would", "go", "there", "."], exp:"ç¾åœ¨ã®äº‹å®Ÿã¨é•ã†ã“ã¨ã‚’è¨€ã†ä»®å®šæ³•ã€‚beå‹•è©ã«wereã€åŠ©å‹•è©ã«wouldã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ã‚‚ã£ã¨æ™‚é–“ãŒã‚ã‚Œã°ã„ã„ã®ã«ãªã‚ã€‚", en:["i", "wish", "i", "had", "more", "time", "."], exp:"I wish ï¼‹ éå»å½¢ ã§ã€Œï½ãªã‚‰ã„ã„ã®ã«ã€ã¨ã„ã†é¡˜æœ›ã‚’è¡¨ã—ã¾ã™ã€‚"},
        {ja:"ã‚‚ã—é³¥ãªã‚‰ã€ã‚ãªãŸã®ã¨ã“ã‚ã¸é£›ã‚“ã§ã„ãã®ã«ã€‚", en:["if", "i", "were", "a", "bird", ",", "i", "would", "fly", "to", "you", "."], exp:"å®Ÿç¾ä¸å¯èƒ½ãªæƒ³åƒã‚‚ä»®å®šæ³•éå»ã®å½¢ã«ãªã‚Šã¾ã™ã€‚"},
        {ja:"ã‚‚ã—æ˜æ—¥æ™´ã‚Œãªã‚‰ã€ç§ãŸã¡ã¯ãƒ”ã‚¯ãƒ‹ãƒƒã‚¯ã«è¡Œãã¾ã™ã€‚", en:["if", "it", "is", "sunny", "tomorrow", ",", "we", "will", "go", "on", "a", "picnic", "."], exp:"ã“ã‚Œã¯å˜ç´”ãªã€Œæ¡ä»¶ã€ã®æ–‡ãªã®ã§ç¾åœ¨å½¢isã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ã‚‚ã—ãŠé‡‘ãŒã‚ã‚Œã°ã€ãã®è»Šã‚’è²·ãˆã‚‹ã®ã«ã€‚", en:["if", "i", "had", "enough", "money", ",", "i", "could", "buy", "the", "car", "."], exp:"äº‹å®Ÿã¨åã™ã‚‹ä»®å®šãªã®ã§hadã¨couldã‚’ä½¿ã„ã¾ã™ã€‚"}
    ]},
    verb_pattern: { name: "ä½¿å½¹ãƒ»å‘½ä»¤", q: [
        {ja:"æ¯ã¯ç§ã«éƒ¨å±‹ã‚’æƒé™¤ã™ã‚‹ã‚ˆã†ã«è¨€ã„ã¾ã—ãŸã€‚", en:["my", "mother", "told", "me", "to", "clean", "my", "room", "."], exp:"tell ï¼‹ äºº ï¼‹ to ï½ã§ã€Œäººã«ï½ã™ã‚‹ã‚ˆã†ã«è¨€ã†ã€ã§ã™ã€‚"},
        {ja:"å½¼ã¯ç§ã«å½¼ã®è»Šã‚’ä½¿ã‚ã›ã¦ãã‚Œã¾ã—ãŸã€‚", en:["he", "let", "me", "use", "his", "car", "."], exp:"let ï¼‹ äºº ï¼‹ å‹•è©ã®åŸå½¢ ã§ã€Œäººã«ï½ã•ã›ã‚‹ï¼ˆè¨±ã™ï¼‰ã€ã§ã™ã€‚"},
        {ja:"ç§ã¯ã‚ãªãŸã«æ‰‹ä¼ã£ã¦ã»ã—ã„ã§ã™ã€‚", en:["i", "want", "you", "to", "help", "me", "."], exp:"want ï¼‹ äºº ï¼‹ to ï½ã§ã€Œäººã«ï½ã—ã¦ã»ã—ã„ã€ã§ã™ã€‚"},
        {ja:"å…ˆç”Ÿã¯ç§ãŸã¡ã«é™ã‹ã«ã™ã‚‹ã‚ˆã†ã«é ¼ã¿ã¾ã—ãŸã€‚", en:["the", "teacher", "asked", "us", "to", "be", "quiet", "."], exp:"ask ï¼‹ äºº ï¼‹ to ï½ã§ã€Œäººã«ï½ã™ã‚‹ã‚ˆã†ã«é ¼ã‚€ã€ã§ã™ã€‚"},
        {ja:"çˆ¶ã¯ç§ã‚’ä¸€äººã§è¡Œã‹ã›ã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", en:["my", "father", "didn't", "let", "me", "go", "alone", "."], exp:"letã®å¾Œã®å‹•è©ã¯åŸå½¢ã«ãªã‚Šã¾ã™ã€‚"}
    ]},
    ing: { name: "é€²è¡Œå½¢", q: [
        {ja:"å½¼ã‚‰ã¯å…¬åœ’ã§ã‚µãƒƒã‚«ãƒ¼ã‚’ã—ã¦ã„ã¾ã™ã€‚", en:["they", "are", "playing", "soccer", "in", "the", "park", "."], exp:"ã€beå‹•è©ï¼‹ï½ingã€‘ã§ç¾åœ¨é€²è¡Œå½¢ã‚’è¡¨ã—ã¾ã™ã€‚"},
        {ja:"ãã®æ™‚ã€ç§ã¯å¤•é£Ÿã‚’é£Ÿã¹ã¦ã„ã¾ã—ãŸã€‚", en:["i", "was", "having", "dinner", "at", "that", "time", "."], exp:"éå»é€²è¡Œå½¢ã€was/were ï¼‹ ï½ingã€‘ã§ã™ã€‚"},
        {ja:"å½¼å¥³ã¯ä»Šã€ãƒ”ã‚¢ãƒã®ç·´ç¿’ã‚’ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", en:["is", "she", "practicing", "the", "piano", "now", "?"], exp:"ç–‘å•æ–‡ã¯beå‹•è©ã‚’å‰ã«å‡ºã—ã¾ã™ã€‚"},
        {ja:"ç§ãŸã¡ã¯ãã®æ™‚ã€èµ°ã£ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚", en:["we", "were", "not", "running", "at", "that", "time", "."], exp:"å¦å®šæ–‡ã¯beå‹•è©ã®å¾Œã«notã‚’ç½®ãã¾ã™ã€‚"},
        {ja:"ä½•ã‚’æ¢ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ", en:["what", "are", "you", "looking", "for", "?"], exp:"ç–‘å•è©(what)ã®å¾Œã«é€²è¡Œå½¢ã®ç–‘å•æ–‡ã‚’ç¶šã‘ã¾ã™ã€‚"}
    ]},
    inf_ger: { name: "ä¸å®šè©ãƒ»å‹•åè©", q: [
        {ja:"ç§ã¯ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã‚‹ã®ã‚’ã‚„ã‚ã¾ã—ãŸã€‚", en:["i", "stopped", "watching", "tv", "."], exp:"stopã¯å¾Œã‚ã«å‹•åè©(~ing)ã‚’ç½®ãã¾ã™ã€‚"},
        {ja:"å½¼ã¯åŒ»è€…ã«ãªã‚‹ã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€‚", en:["he", "decided", "to", "be", "a", "doctor", "."], exp:"decideã¯å¾Œã‚ã«ä¸å®šè©(toï¼‹å‹•è©ã®åŸå½¢)ã‚’ç½®ãã¾ã™ã€‚"},
        {ja:"ç§ã¯å°†æ¥ã€æµ·å¤–ã«è¡ŒããŸã„ã§ã™ã€‚", en:["i", "want", "to", "go", "abroad", "in", "the", "future", "."], exp:"want to ï½ã§ã€Œï½ã—ãŸã„ã€ã§ã™ã€‚"},
        {ja:"å½¼å¥³ã¯æœ¬ã‚’èª­ã‚€ã“ã¨ãŒå¥½ãã§ã™ã€‚", en:["she", "enjoys", "reading", "books", "."], exp:"enjoyã®å¾Œã‚ã¯å‹•åè©(~ing)ã§ã™ã€‚"},
        {ja:"ç§ã®å¤¢ã¯ä¸–ç•Œä¸­ã‚’æ—…è¡Œã™ã‚‹ã“ã¨ã§ã™ã€‚", en:["my", "dream", "is", "to", "travel", "around", "the", "world", "."], exp:"ä¸å®šè©ã®åè©çš„ç”¨æ³•ã§ã™ã€‚"}
    ]},
    comp: { name: "æ¯”è¼ƒ", q: [
        {ja:"ã“ã®æœ¬ã¯ã‚ã®æœ¬ã‚ˆã‚Šé¢ç™½ã„ã§ã™ã€‚", en:["this", "book", "is", "more", "interesting", "than", "that", "one", "."], exp:"é•·ã„å˜èªã¯more ï½ thanã‚’ä½¿ã£ã¦æ¯”è¼ƒã—ã¾ã™ã€‚"},
        {ja:"å¥ã¯ã‚¯ãƒ©ã‚¹ã§ä¸€ç•ªèƒŒãŒé«˜ã„ã§ã™ã€‚", en:["ken", "is", "the", "tallest", "in", "his", "class", "."], exp:"ã€Œä¸€ç•ªï½ã€ã¯the ï¼‹ æœ€ä¸Šç´š(-est)ã‚’ä½¿ã„ã¾ã™ã€‚"},
        {ja:"ç§ã¯ã‚ãªãŸã¨åŒã˜ãã‚‰ã„å¿™ã—ã„ã§ã™ã€‚", en:["i", "am", "as", "busy", "as", "you", "."], exp:"ã€ŒåŒã˜ãã‚‰ã„ï½ã€ã¯as ï½ asã§æŒŸã¿ã¾ã™ã€‚"},
        {ja:"ã“ã®è»Šã¯ã‚ã®è»Šã‚ˆã‚Šé€Ÿãèµ°ã‚Šã¾ã™ã€‚", en:["this", "car", "runs", "faster", "than", "that", "one", "."], exp:"å‰¯è©fastã®æ¯”è¼ƒç´šã¯fasterã§ã™ã€‚"},
        {ja:"ä¸–ç•Œã§ä¸€ç•ªé«˜ã„å±±ã¯ä½•ã§ã™ã‹ï¼Ÿ", en:["what", "is", "the", "highest", "mountain", "in", "the", "world", "?"], exp:"æœ€ä¸Šç´šã®å‰ã«ã¯theã‚’å¿˜ã‚Œãšã«ã€‚"}
    ]},
    aux: { name: "åŠ©å‹•è©", q: [
        {ja:"ã“ã“ã§å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‚ˆã€‚", en:["you", "may", "take", "pictures", "here", "."], exp:"mayã¯ã€Œï½ã—ã¦ã‚‚ã‚ˆã„ã€ã¨ã„ã†è¨±å¯ã‚’è¡¨ã—ã¾ã™ã€‚"},
        {ja:"ã‚ãªãŸã¯ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚", en:["you", "must", "study", "hard", "."], exp:"mustã¯ã€Œï½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã¨ã„ã†ç¾©å‹™ã§ã™ã€‚"},
        {ja:"çª“ã‚’é–‹ã‘ã¦ãã‚Œã¾ã›ã‚“ã‹ï¼Ÿ", en:["will", "you", "open", "the", "window", "?"], exp:"Will you ï½? ã§ã€Œï½ã—ã¦ãã‚Œã¾ã›ã‚“ã‹ï¼Ÿã€ã¨ã„ã†ä¾é ¼ã§ã™ã€‚"},
        {ja:"ç§ã¯è‹±èªã‚’ä¸Šæ‰‹ã«è©±ã™ã“ã¨ãŒã§ãã¾ã™ã€‚", en:["i", "can", "speak", "english", "well", "."], exp:"åŠ©å‹•è©ã®å¾Œã¯å¿…ãšã€Œå‹•è©ã®åŸå½¢ã€ã§ã™ã€‚"},
        {ja:"ã‚ãªãŸã¯æ˜æ—¥ã€ãã“ã¸è¡Œãå¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", en:["you", "don't", "have", "to", "go", "there", "tomorrow", "."], exp:"don't have toã§ã€Œï½ã™ã‚‹å¿…è¦ã¯ãªã„ã€ã§ã™ã€‚"}
    ]}
};

let score = 0;
const ranks = [
    {min: 0, label: "BEGINNER"},
    {min: 500, label: "ROOKIE"},
    {min: 1000, label: "PRO"},
    {min: 3000, label: "MASTER"},
    {min: 5000, label: "LEGEND"}
];

const grid = document.getElementById('grid');
Object.keys(data).forEach(key => {
    const item = document.createElement('div');
    item.className = 'grammar-item';
    item.innerHTML = `<input type="checkbox" value="${key}"> <span>${data[key].name}</span>`;
    
    // labelå…¨ä½“ã®ã‚¯ãƒªãƒƒã‚¯ã§åå¿œã•ã›ã‚‹
    item.addEventListener('click', () => {
        const cb = item.querySelector('input');
        cb.checked = !cb.checked;
        item.classList.toggle('selected', cb.checked);
    });
    grid.appendChild(item);
});

let currentQuestions = [], qIndex = 0;

function startGame() {
    const checkboxes = document.querySelectorAll('#grid input:checked');
    if(!checkboxes.length) return alert("æ–‡æ³•ã‚’é¸ã‚“ã§ã­ï¼");
    
    currentQuestions = [];
    checkboxes.forEach(cb => {
        data[cb.value].q.forEach(q => currentQuestions.push({...q, category: data[cb.value].name}));
    });
    currentQuestions.sort(() => Math.random() - 0.5);
    qIndex = 0; score = 0; updateScore(0);
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    loadQuestion();
}

function updateScore(pts) {
    score += pts;
    document.getElementById('score').innerText = score;
    const rankLabel = ranks.filter(r => score >= r.min).pop().label;
    document.getElementById('rank').innerText = rankLabel;
}

function loadQuestion() {
    const q = currentQuestions[qIndex];
    document.getElementById('ja-text').innerText = q.ja;
    document.getElementById('q-count').innerText = `Q. ${qIndex + 1} / ${currentQuestions.length}`;
    document.getElementById('feedback').innerText = "";
    document.getElementById('explanation-box').style.display = "none";
    document.getElementById('action-btn').style.display = "inline-block";
    
    const hand = document.getElementById('hand-zone');
    const drop = document.getElementById('drop-zone');
    hand.innerHTML = ""; drop.innerHTML = "";
    
    [...q.en].sort(() => Math.random() - 0.5).forEach(w => {
        const d = document.createElement('div');
        d.className = 'word-card' + (w === "." || w === "?" || w === "," ? ' period' : '');
        d.innerText = w;
        hand.appendChild(d);
    });
}

const sortOptions = { group: 'words', animation: 200 };
new Sortable(document.getElementById('hand-zone'), sortOptions);
new Sortable(document.getElementById('drop-zone'), sortOptions);

function check() {
    const user = Array.from(document.getElementById('drop-zone').children).map(c => c.innerText).join(" ");
    const ans = currentQuestions[qIndex].en.join(" ");
    
    // ã‚«ãƒ³ãƒç­‰ã®ã‚¹ãƒšãƒ¼ã‚¹å¾®èª¿æ•´
    const format = s => s.replace(/ , /g, ", ").replace(/ \. /g, ". ").replace(/ \? /g, "? ").trim();

    if(format(user) === format(ans)) {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        document.getElementById('feedback').innerHTML = "<span style='color:#fab005'>âœ¨ æ­£è§£ï¼ EXCELLENT! âœ¨</span>";
        updateScore(100);
        document.getElementById('action-btn').style.display = "none";
        document.getElementById('explanation-box').style.display = "block";
        document.getElementById('exp-grammar').innerText = `ã€ãƒ†ãƒ¼ãƒï¼š${currentQuestions[qIndex].category}ã€‘`;
        document.getElementById('exp-text').innerText = currentQuestions[qIndex].exp;
    } else {
        document.getElementById('feedback').innerHTML = "<span style='color:#fa5252'>é•ã†ã¿ãŸã„...ã‚‚ã†ä¸€åº¦ï¼</span>";
        setTimeout(() => document.getElementById('feedback').innerText = "", 1200);
    }
}

function next() {
    qIndex++;
    if(qIndex < currentQuestions.length) loadQuestion();
    else { alert("ğŸ‰ ã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒªã‚¢ï¼ ã‚¹ã‚³ã‚¢: " + score); location.reload(); }
}
</script>
</body>
</html>
