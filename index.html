<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中学英語・構築クエスト</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root { --primary: #ff6b6b; --secondary: #4ecdc4; --bg: #f0f7f7; --accent: #ffe66d; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 8px 0 #cbdadb; width: 95%; max-width: 700px; text-align: center; }
        .drop-zone { min-height: 100px; margin: 10px 0; padding: 15px; background: #fff; border: 3px solid var(--secondary); border-radius: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; position: relative; }
        .drop-zone:empty::before { content: "ここにカードを並べてね"; color: #ccc; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        .hand-zone { min-height: 100px; margin: 10px 0; padding: 15px; background: #e9ecef; border-radius: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .word-card { background: var(--accent); padding: 10px 18px; border-radius: 10px; cursor: grab; font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 0 #d4c05d; }
        .grammar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 15px 0; }
        .grammar-grid label { padding: 10px; background: #eee; border-radius: 10px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .grammar-grid input { display: none; }
        .grammar-grid label:has(input:checked) { background: var(--secondary); color: white; box-shadow: 0 4px 0 #3baea5; }
        .btn { padding: 15px 40px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; background: var(--primary); color: white; box-shadow: 0 5px 0 #c44; font-weight: bold; margin-top: 10px; }
        #game-screen { display: none; }
        .notice { font-size: 0.85rem; color: #d00; font-weight: bold; background: #fff0f0; padding: 5px; border-radius: 5px; margin-bottom: 10px; }
        .msg { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
    </style>
</head>
<body>
<div id="setup-screen" class="container">
    <h1>⚔️ 文法構築クエスト</h1>
    <p>挑戦するカテゴリーを選んでね</p>
    <div class="grammar-grid" id="grid"></div>
    <button class="btn" onclick="startGame()">冒険開始！</button>
</div>
<div id="game-screen" class="container">
    <div class="notice">※文頭に来る語も小文字になっています</div>
    <div style="display: flex; justify-content: space-between;">
        <div id="score">Score: 0</div>
        <div id="q-count"></div>
    </div>
    <p id="ja-text" style="font-size: 1.3rem; font-weight: bold; margin: 15px 0;"></p>
    <div class="msg">【組み立てスペース】</div>
    <div id="drop-zone" class="drop-zone"></div>
    <div class="msg">【自分のカード】</div>
    <div id="hand-zone" class="hand-zone"></div>
    <button class="btn" onclick="check()">判定！</button>
    <div id="feedback" style="margin-top:15px; font-weight:bold;"></div>
</div>
<script>
const data = {
    passive: { name: "受け身", q: [
        {ja:"この手紙は健によって書かれました。", en:["this", "letter", "was", "written", "by", "ken."]},
        {ja:"英語は多くの国で話されています。", en:["english", "is", "spoken", "in", "many", "countries."]},
        {ja:"その寺は約100年前に建てられました。", en:["the", "temple", "was", "built", "about", "100", "years", "ago."]},
        {ja:"このケーキは母によって作られました。", en:["this", "cake", "was", "made", "by", "my", "mother."]},
        {ja:"その猫はみんなに愛されています。", en:["the", "cat", "is", "loved", "by", "everyone."]}
    ]},
    perfect: { name: "完了形", q: [
        {ja:"私は3年間ずっとテニスをしています。", en:["i", "have", "played", "tennis", "for", "three", "years."]},
        {ja:"あなたはもう宿題を終えましたか？", en:["have", "you", "finished", "your", "homework", "yet?"]},
        {ja:"私は一度も北海道へ行ったことがありません。", en:["i", "have", "never", "been", "to", "hokkaido."]},
        {ja:"彼はちょうど駅に着いたところです。", en:["he", "has", "just", "arrived", "at", "the", "station."]},
        {ja:"私たちは子供の頃から友達です。", en:["we", "have", "been", "friends", "since", "we", "were", "children."]}
    ]},
    post: { name: "後置修飾", q: [
        {ja:"向こうで歌っている女の子は花子です。", en:["the", "girl", "singing", "over", "there", "is", "hanako."]},
        {ja:"これは日本で作られた車です。", en:["this", "is", "a", "car", "made", "in", "japan."]},
        {ja:"私は彼によって書かれた本を読みました。", en:["i", "read", "a", "book", "written", "by", "him."]},
        {ja:"ピアノを弾いている少年を知っていますか？", en:["do", "you", "know", "the", "boy", "playing", "the", "piano?"]},
        {ja:"あそこで走っている犬を見て。", en:["look", "at", "the", "dog", "running", "there."]}
    ]},
    relative: { name: "関係代名詞", q: [
        {ja:"これは私が昨日買ったカメラです。", en:["this", "is", "the", "camera", "that", "i", "bought", "yesterday."]},
        {ja:"私は親切な心を持つ少年を知っています。", en:["i", "know", "a", "boy", "who", "has", "a", "kind", "heart."]},
        {ja:"あなたが探している鍵はここにあります。", en:["the", "key", "which", "you", "are", "looking", "for", "is", "here."]},
        {ja:"あそこに立っている男性は私の父です。", en:["the", "man", "who", "is", "standing", "there", "is", "my", "father."]},
        {ja:"これは多くの写真がある本です。", en:["this", "is", "a", "book", "which", "has", "many", "pictures."]}
    ]},
    ing: { name: "進行形", q: [
        {ja:"彼らは公園でサッカーをしています。", en:["they", "are", "playing", "soccer", "in", "the", "park."]},
        {ja:"その時、私は夕食を食べていました。", en:["i", "was", "having", "dinner", "at", "that", "time."]},
        {ja:"彼女は今、ピアノの練習をしていますか？", en:["is", "she", "practicing", "the", "piano", "now?"]},
        {ja:"私たちはその時、走っていませんでした。", en:["we", "were", "not", "running", "at", "that", "time."]},
        {ja:"何を探しているのですか？", en:["what", "are", "you", "looking", "for?"]}
    ]},
    inf_ger: { name: "不定詞・動名詞", q: [
        {ja:"私はテレビを見るのをやめました。", en:["i", "stopped", "watching", "tv."]},
        {ja:"彼は医者になることを決めました。", en:["he", "decided", "to", "be", "a", "doctor."]},
        {ja:"私は将来、海外に行きたいです。", en:["i", "want", "to", "go", "abroad", "in", "the", "future."]},
        {ja:"彼女は本を読むことが好きです。", en:["she", "enjoys", "reading", "books."]},
        {ja:"私の夢は世界中を旅行することです。", en:["my", "dream", "is", "to", "travel", "around", "the", "world."]}
    ]},
    indirect: { name: "間接疑問文", q: [
        {ja:"彼がどこに住んでいるか知っていますか？", en:["do", "you", "know", "where", "he", "lives?"]},
        {ja:"彼女が何と言ったか教えてください。", en:["please", "tell", "me", "what", "she", "said."]},
        {ja:"私はその時、何時か分かりませんでした。", en:["i", "did", "not", "know", "what", "time", "it", "was", "then."]},
        {ja:"彼が誰なのか私は知りません。", en:["i", "don't", "know", "who", "he", "is."]},
        {ja:"いつ会議が始まるか知っていますか？", en:["do", "you", "know", "when", "the", "meeting", "will", "start?"]}
    ]},
    comp: { name: "比較", q: [
        {ja:"この本はあの本より面白いです。", en:["this", "book", "is", "more", "interesting", "than", "that", "one."]},
        {ja:"健はクラスで一番背が高いです。", en:["ken", "is", "the", "tallest", "in", "his", "class."]},
        {ja:"私はあなたと同じくらい忙しいです。", en:["i", "am", "as", "busy", "as", "you."]},
        {ja:"この車はあの車より速く走ります。", en:["this", "car", "runs", "faster", "than", "that", "one."]},
        {ja:"世界で一番高い山は何ですか？", en:["what", "is", "the", "highest", "mountain", "in", "the", "world?"]}
    ]},
    aux: { name: "助動詞", q: [
        {ja:"ここで写真を撮ってもいいですよ。", en:["you", "may", "take", "pictures", "here."]},
        {ja:"あなたは一生懸命勉強しなければなりません。", en:["you", "must", "study", "hard."]},
        {ja:"窓を開けてくれませんか？", en:["will", "you", "open", "the", "window?"]},
        {ja:"私は英語を上手に話すことができます。", en:["i", "can", "speak", "english", "well."]},
        {ja:"あなたは明日、そこへ行く必要はありません。", en:["you", "don't", "have", "to", "go", "there", "tomorrow."]}
    ]},
    if: { name: "仮定法", q: [
        {ja:"もし私があなたなら、そこへ行くだろうに。", en:["if", "i", "were", "you,", "i", "would", "go", "there."]},
        {ja:"もっと時間があればいいのになあ。", en:["i", "wish", "i", "had", "more", "time."]},
        {ja:"もし鳥なら、あなたのところへ飛んでいくのに。", en:["if", "i", "were", "a", "bird,", "i", "would", "fly", "to", "you."]},
        {ja:"もし明日晴れなら、私たちはピクニックに行きます。", en:["if", "it", "is", "sunny", "tomorrow,", "we", "will", "go", "on", "a", "picnic."]},
        {ja:"もしお金があれば、その車を買えるのに。", en:["if", "i", "had", "enough", "money,", "i", "could", "buy", "the", "car."]}
    ]},
    verb_pattern: { name: "使役・命令", q: [
        {ja:"母は私に部屋を掃除するように言いました。", en:["my", "mother", "told", "me", "to", "clean", "my", "room."]},
        {ja:"彼は私に彼の車を使わせてくれました。", en:["he", "let", "me", "use", "his", "car."]},
        {ja:"私はあなたに手伝ってほしいです。", en:["i", "want", "you", "to", "help", "me."]},
        {ja:"先生は私たちに静かにするように頼みました。", en:["the", "teacher", "asked", "us", "to", "be", "quiet."]},
        {ja:"父は私を一人で行かせてくれませんでした。", en:["my", "father", "didn't", "let", "me", "go", "alone."]}
    ]}
};
const grid = document.getElementById('grid');
Object.keys(data).forEach(key => {
    grid.innerHTML += `<label><input type="checkbox" value="${key}"> <span>${data[key].name}</span></label>`;
});
let currentQ = [], qIndex = 0, score = 0;
function startGame() {
    const selected = Array.from(document.querySelectorAll('input:checked')).map(i => i.value);
    if(!selected.length) return alert("文法を選んでね！");
    currentQ = [];
    selected.forEach(k => currentQ.push(...data[k].q));
    currentQ.sort(() => Math.random() - 0.5);
    qIndex = 0; score = 0;
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    next();
}
function next() {
    if(qIndex >= currentQ.length) {
        alert("全問クリア！スコア: " + score);
        location.reload();
        return;
    }
    const q = currentQ[qIndex];
    document.getElementById('ja-text').innerText = q.ja;
    document.getElementById('q-count').innerText = (qIndex+1) + " / " + currentQ.length;
    document.getElementById('feedback').innerText = "";
    const hand = document.getElementById('hand-zone');
    const drop = document.getElementById('drop-zone');
    hand.innerHTML = ""; drop.innerHTML = "";
    [...q.en].sort(() => Math.random()-0.5).forEach(w => {
        const d = document.createElement('div');
        d.className = 'word-card'; d.innerText = w;
        hand.appendChild(d);
    });
}
const sortOptions = { group: 'words', animation: 150 };
new Sortable(document.getElementById('hand-zone'), sortOptions);
new Sortable(document.getElementById('drop-zone'), sortOptions);
function check() {
    const user = Array.from(document.getElementById('drop-zone').children).map(c => c.innerText.toLowerCase()).join(" ");
    const ans = currentQ[qIndex].en.map(w => w.toLowerCase()).join(" ");
    if(user === ans) {
        score += 100;
        document.getElementById('score').innerText = "Score: " + score;
        document.getElementById('feedback').innerHTML = "<span style='color:orange'>正解！✨</span>";
        qIndex++;
        setTimeout(next, 1000);
    } else {
        document.getElementById('feedback').innerHTML = "<span style='color:gray'>まだ違うみたい...</span>";
    }
}
</script>
</body>
</html>
